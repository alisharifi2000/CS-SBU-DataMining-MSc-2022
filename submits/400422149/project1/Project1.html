<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2022-05-19 Thu 19:46 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Project1</title>
<meta name="author" content="Mohammadb Ghorbani" />
<meta name="generator" content="Org Mode" />
<style>
  #content { max-width: 60em; margin: auto; }
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #e6e6e6;
    border-radius: 3px;
    background-color: #f2f2f2;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: auto;
  }
  pre.src:before {
    display: none;
    position: absolute;
    top: -8px;
    right: 12px;
    padding: 3px;
    color: #555;
    background-color: #f2f2f299;
  }
  pre.src:hover:before { display: inline; margin-top: 14px;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-authinfo::before { content: 'Authinfo'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { width: 90%; }
</style>
</head>
<body>
<div id="content" class="content">
<h1 class="title">Project1</h1>
<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#org3e6fd92">1. Airbnb</a>
<ul>
<li><a href="#org73bf3c7">1.1. import libraries</a></li>
<li><a href="#org01f43b1">1.2. config packages</a></li>
<li><a href="#org2d4cd4f">1.3. read data</a></li>
<li><a href="#orgd647fa7">1.4. handling missing values</a>
<ul>
<li><a href="#org5089ff4">1.4.1. name</a></li>
<li><a href="#org78fa9f5">1.4.2. host name</a></li>
<li><a href="#org4dd2c7a">1.4.3. last review</a></li>
<li><a href="#org59929ee">1.4.4. reviews per month</a></li>
<li><a href="#orgcad2a93">1.4.5. fill missing values with 0</a></li>
</ul>
</li>
<li><a href="#org0930965">1.5. Clean duplicates</a></li>
<li><a href="#orgd7b6b99">1.6. Get Correlation between data</a></li>
<li><a href="#orgcd758f4">1.7. Handle Outliers</a>
<ul>
<li><a href="#org6ab3305">1.7.1. price</a></li>
<li><a href="#orgcf2147a">1.7.2. minimum nights</a></li>
</ul>
</li>
<li><a href="#orgf2c60d0">1.8. Visual data</a>
<ul>
<li><a href="#org4d80b64">1.8.1. neighbourhood group</a></li>
<li><a href="#org3be795f">1.8.2. neighbourhood</a></li>
<li><a href="#org92d4b7f">1.8.3. room type</a></li>
<li><a href="#org4a1f8bc">1.8.4. availability 365</a></li>
</ul>
</li>
<li><a href="#orgd52cd09">1.9. Analysis hosts</a></li>
<li><a href="#org88fec67">1.10. Comments</a></li>
<li><a href="#org2eea255">1.11. Hypothesis Tests</a>
<ul>
<li><a href="#org3cec0d8">1.11.1. Manhattan price distribution is normal</a></li>
<li><a href="#org59cc957">1.11.2. Staten Island price distribution is normal</a></li>
<li><a href="#orgc70a56d">1.11.3. top hosts and top host based on reviews are the same</a></li>
<li><a href="#org107be31">1.11.4. People spend same amount of money on Manhattan and Brooklyn</a></li>
<li><a href="#org41de14b">1.11.5. relation between all year availability with price</a></li>
</ul>
</li>
<li><a href="#org8c8c72c">1.12. Predict Price</a>
<ul>
<li><a href="#org501cda0">1.12.1. Prepare Data for model</a></li>
<li><a href="#orgfc5a21b">1.12.2. spilit data</a></li>
<li><a href="#org7d5e074">1.12.3. model</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#orgdefbc62">2. Apartment rental offers in Germany</a>
<ul>
<li><a href="#orge2b440f">2.1. import libraries</a></li>
<li><a href="#org79d744a">2.2. config packages</a></li>
<li><a href="#org0f732f3">2.3. read data</a></li>
<li><a href="#org3dbf95e">2.4. handling missing values &amp; cleaning data</a>
<ul>
<li><a href="#orgb620f8c">2.4.1. null data</a></li>
<li><a href="#orgd712060">2.4.2. delete columns with more than %50 missing values</a></li>
<li><a href="#org7ca1f50">2.4.3. delete columns that are not usefull</a></li>
<li><a href="#orgeae3715">2.4.4. delete unusal data</a></li>
<li><a href="#org32dbc30">2.4.5. fill numeric data with mean</a></li>
<li><a href="#org8ba2594">2.4.6. categorical data with lots of states</a></li>
<li><a href="#orgc6a17d8">2.4.7. fill categorical data with other</a></li>
<li><a href="#org448a119">2.4.8. reduce number of categories</a></li>
</ul>
</li>
<li><a href="#orgd7b9ff5">2.5. Clean duplicates</a>
<ul>
<li><a href="#org72348c1">2.5.1. remove duplicates</a></li>
</ul>
</li>
<li><a href="#orge95ad26">2.6. Handle Outliers</a></li>
<li><a href="#orgcd93ee1">2.7. Visual data</a>
<ul>
<li><a href="#org28e1f97">2.7.1. regio2 top 13</a></li>
<li><a href="#org95c5681">2.7.2. livingSpace</a></li>
<li><a href="#org759af9d">2.7.3. baseRent</a></li>
<li><a href="#org0297c4d">2.7.4. houses</a></li>
</ul>
</li>
<li><a href="#org799934a">2.8. Models</a>
<ul>
<li><a href="#org1730360">2.8.1. prepare data for model</a></li>
<li><a href="#org776d1ec">2.8.2. split data and model</a></li>
</ul>
</li>
<li><a href="#org641a544">2.9. ‫‪Multiprocessing‬‬</a></li>
<li><a href="#org22a5db7">2.10. <span class="todo TODO">TODO</span> dask &amp; pyspark</a></li>
</ul>
</li>
</ul>
</div>
</div>

<div id="outline-container-org3e6fd92" class="outline-2">
<h2 id="org3e6fd92"><span class="section-number-2">1.</span> Airbnb</h2>
<div class="outline-text-2" id="text-1">
</div>


<div id="outline-container-org73bf3c7" class="outline-3">
<h3 id="org73bf3c7"><span class="section-number-3">1.1.</span> import libraries</h3>
<div class="outline-text-3" id="text-1-1">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #51afef;">import</span> warnings
<span style="color: #51afef;">import</span> pandas <span style="color: #51afef;">as</span> pd
<span style="color: #51afef;">from</span> scipy.stats <span style="color: #51afef;">import</span> shapiro, pearsonr, ttest_rel
<span style="color: #51afef;">import</span> numpy <span style="color: #51afef;">as</span> np
<span style="color: #51afef;">import</span> matplotlib.pyplot <span style="color: #51afef;">as</span> plt
<span style="color: #51afef;">import</span> seaborn <span style="color: #51afef;">as</span> sns
<span style="color: #51afef;">from</span> sklearn.linear_model <span style="color: #51afef;">import</span> LinearRegression
<span style="color: #51afef;">from</span> sklearn.model_selection <span style="color: #51afef;">import</span> train_test_split
<span style="color: #51afef;">from</span> sklearn.metrics <span style="color: #51afef;">import</span> r2_score
<span style="color: #51afef;">from</span> genderize <span style="color: #51afef;">import</span> Genderize
</pre>
</div>
</div>
</div>
<div id="outline-container-org01f43b1" class="outline-3">
<h3 id="org01f43b1"><span class="section-number-3">1.2.</span> config packages</h3>
<div class="outline-text-3" id="text-1-2">
<div class="org-src-container">
<pre class="src src-python">warnings.filterwarnings(<span style="color: #98be65;">"ignore"</span>)

<span style="color: #5B6268;">#</span><span style="color: #5B6268;">pd.set_option("display.max_columns", None)</span>
<span style="color: #5B6268;">#</span><span style="color: #5B6268;">pd.set_option("display.max_rows", None)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org2d4cd4f" class="outline-3">
<h3 id="org2d4cd4f"><span class="section-number-3">1.3.</span> read data</h3>
<div class="outline-text-3" id="text-1-3">
<ul class="org-ul">
<li>read data from csv with pandas package</li>
</ul>

<div class="org-src-container">
<pre class="src src-python">
<span style="color: #dcaeea;">raw_data</span> = pd.read_csv(<span style="color: #98be65;">'AB_NYC_2019.csv'</span>)
<span style="color: #c678dd;">print</span>(raw_data.head())
<span style="color: #c678dd;">print</span>(raw_data.info())

</pre>
</div>

<pre class="example" id="orge6fa8c1">
     id                                              name  host_id    host_name neighbourhood_group neighbourhood  ...  minimum_nights  number_of_reviews last_review  reviews_per_month  calculated_host_listings_count  availability_365
0  2539                Clean &amp; quiet apt home by the park     2787         John            Brooklyn    Kensington  ...               1                  9  2018-10-19               0.21                               6               365
1  2595                             Skylit Midtown Castle     2845     Jennifer           Manhattan       Midtown  ...               1                 45  2019-05-21               0.38                               2               355
2  3647               THE VILLAGE OF HARLEM....NEW YORK !     4632    Elisabeth           Manhattan        Harlem  ...               3                  0         NaN                NaN                               1               365
3  3831                   Cozy Entire Floor of Brownstone     4869  LisaRoxanne            Brooklyn  Clinton Hill  ...               1                270  2019-07-05               4.64                               1               194
4  5022  Entire Apt: Spacious Studio/Loft by central park     7192        Laura           Manhattan   East Harlem  ...              10                  9  2018-11-19               0.10                               1                 0

[5 rows x 16 columns]
&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 48895 entries, 0 to 48894
Data columns (total 16 columns):
 #   Column                          Non-Null Count  Dtype
---  ------                          --------------  -----
 0   id                              48895 non-null  int64
 1   name                            48879 non-null  object
 2   host_id                         48895 non-null  int64
 3   host_name                       48874 non-null  object
 4   neighbourhood_group             48895 non-null  object
 5   neighbourhood                   48895 non-null  object
 6   latitude                        48895 non-null  float64
 7   longitude                       48895 non-null  float64
 8   room_type                       48895 non-null  object
 9   price                           48895 non-null  int64
 10  minimum_nights                  48895 non-null  int64
 11  number_of_reviews               48895 non-null  int64
 12  last_review                     38843 non-null  object
 13  reviews_per_month               38843 non-null  float64
 14  calculated_host_listings_count  48895 non-null  int64
 15  availability_365                48895 non-null  int64
dtypes: float64(3), int64(7), object(6)
memory usage: 6.0+ MB
None
</pre>
</div>
</div>


<div id="outline-container-orgd647fa7" class="outline-3">
<h3 id="orgd647fa7"><span class="section-number-3">1.4.</span> handling missing values</h3>
<div class="outline-text-3" id="text-1-4">
<ul class="org-ul">
<li>there is 4 series that contain missing values</li>
</ul>

<div class="org-src-container">
<pre class="src src-python">raw_data.isnull().<span style="color: #c678dd;">sum</span>()


</pre>
</div>

<pre class="example" id="orgf29a340">
id                                    0
name                                 16
host_id                               0
host_name                            21
neighbourhood_group                   0
neighbourhood                         0
latitude                              0
longitude                             0
room_type                             0
price                                 0
minimum_nights                        0
number_of_reviews                     0
last_review                       10052
reviews_per_month                 10052
calculated_host_listings_count        0
availability_365                      0
dtype: int64
</pre>
</div>

<div id="outline-container-org5089ff4" class="outline-4">
<h4 id="org5089ff4"><span class="section-number-4">1.4.1.</span> name</h4>
<div class="outline-text-4" id="text-1-4-1">
<ul class="org-ul">
<li>right now we will not use this feature , we can drop it , or set it to 0.</li>
</ul>

<div class="org-src-container">
<pre class="src src-python">
<span style="color: #c678dd;">print</span>(raw_data.name.describe())

</pre>
</div>
</div>
</div>

<div id="outline-container-org78fa9f5" class="outline-4">
<h4 id="org78fa9f5"><span class="section-number-4">1.4.2.</span> host name</h4>
<div class="outline-text-4" id="text-1-4-2">
<ul class="org-ul">
<li>this feature will be used to predict gender of host so we will keep it for now and fillna with 0, also we can use the value 0 for this feature to see if rows that don&rsquo;t have name can have any effect on reviews.</li>
</ul>
<div class="org-src-container">
<pre class="src src-python">
<span style="color: #c678dd;">print</span>(raw_data.host_name.describe())
</pre>
</div>
</div>
</div>

<div id="outline-container-org4dd2c7a" class="outline-4">
<h4 id="org4dd2c7a"><span class="section-number-4">1.4.3.</span> last review</h4>
<div class="outline-text-4" id="text-1-4-3">
<ul class="org-ul">
<li>if we don&rsquo;t have any last review we don&rsquo;t have any reviews at all. so we will keep this feature and fill it with 0.</li>
</ul>

<div class="org-src-container">
<pre class="src src-python">
<span style="color: #c678dd;">print</span>(raw_data.last_review.describe())

</pre>
</div>
</div>
</div>

<div id="outline-container-org59929ee" class="outline-4">
<h4 id="org59929ee"><span class="section-number-4">1.4.4.</span> reviews per month</h4>
<div class="outline-text-4" id="text-1-4-4">
<ul class="org-ul">
<li>we have same number of missing value in last review and reviews per month , so any row that doesn&rsquo;t have any last review should have null value for reviews per month, like last review we will fill it with 0.</li>
</ul>

<div class="org-src-container">
<pre class="src src-python">


<span style="color: #c678dd;">print</span>(raw_data.reviews_per_month.describe())
<span style="color: #dcaeea;">mask</span> = (raw_data.reviews_per_month.isnull())
<span style="color: #c678dd;">print</span>(raw_data[mask])

</pre>
</div>
</div>
</div>

<div id="outline-container-orgcad2a93" class="outline-4">
<h4 id="orgcad2a93"><span class="section-number-4">1.4.5.</span> fill missing values with 0</h4>
<div class="outline-text-4" id="text-1-4-5">
<div class="org-src-container">
<pre class="src src-python">
<span style="color: #dcaeea;">data</span> = raw_data.fillna({<span style="color: #98be65;">'reviews_per_month'</span>:<span style="color: #da8548; font-weight: bold;">0</span>, <span style="color: #98be65;">'last_review'</span>:<span style="color: #da8548; font-weight: bold;">0</span>, <span style="color: #98be65;">'name'</span>:<span style="color: #da8548; font-weight: bold;">0</span>, <span style="color: #98be65;">'host_name'</span>:<span style="color: #da8548; font-weight: bold;">0</span>})
data.isnull().<span style="color: #c678dd;">sum</span>()

</pre>
</div>

<pre class="example" id="org31c7b60">
id                                0
name                              0
host_id                           0
host_name                         0
neighbourhood_group               0
neighbourhood                     0
latitude                          0
longitude                         0
room_type                         0
price                             0
minimum_nights                    0
number_of_reviews                 0
last_review                       0
reviews_per_month                 0
calculated_host_listings_count    0
availability_365                  0
dtype: int64
</pre>
</div>
</div>
</div>

<div id="outline-container-org0930965" class="outline-3">
<h3 id="org0930965"><span class="section-number-3">1.5.</span> Clean duplicates</h3>
<div class="outline-text-3" id="text-1-5">
<ul class="org-ul">
<li>remove duplicates from dataset</li>
</ul>


<div class="org-src-container">
<pre class="src src-python">
<span style="color: #c678dd;">print</span>(raw_data.duplicated().<span style="color: #c678dd;">sum</span>())
raw_data.drop_duplicates(inplace=<span style="color: #a9a1e1;">True</span>)

</pre>
</div>
</div>
</div>

<div id="outline-container-orgd7b6b99" class="outline-3">
<h3 id="orgd7b6b99"><span class="section-number-3">1.6.</span> Get Correlation between data</h3>
<div class="outline-text-3" id="text-1-6">
<div class="org-src-container">
<pre class="src src-python">
raw_data.columns

</pre>
</div>

<div class="org-src-container">
<pre class="src src-python">plt.clf()
<span style="color: #dcaeea;">corr</span> = raw_data.corr(method=<span style="color: #98be65;">'kendall'</span>)
plt.figure(figsize=(<span style="color: #da8548; font-weight: bold;">15</span>,<span style="color: #da8548; font-weight: bold;">15</span>))
corr_fname = <span style="color: #98be65;">'img/correlation.png'</span>
sns_plot = sns.heatmap(corr, annot=<span style="color: #a9a1e1;">True</span>)
plt.savefig(corr_fname)
corr_fname

</pre>
</div>

<p>
<a href=""></a>
</p>
</div>
</div>

<div id="outline-container-orgcd758f4" class="outline-3">
<h3 id="orgcd758f4"><span class="section-number-3">1.7.</span> Handle Outliers</h3>
<div class="outline-text-3" id="text-1-7">
<ul class="org-ul">
<li>there is no model for training so will not drop any data unless for training model , so before training outliers will be droped for now we will just check them and plot them.</li>
</ul>
</div>

<div id="outline-container-org6ab3305" class="outline-4">
<h4 id="org6ab3305"><span class="section-number-4">1.7.1.</span> price</h4>
<div class="outline-text-4" id="text-1-7-1">
<ul class="org-ul">
<li>let&rsquo;s check the price data and see the results</li>
</ul>


<div class="org-src-container">
<pre class="src src-python">plt.clf()
plt.hist(data.price, bins=<span style="color: #da8548; font-weight: bold;">100</span>)
price_hist_plot = plt.plot()
price_hist_fname = <span style="color: #98be65;">'img/raw_price_hist.png'</span>
plt.savefig(price_hist_fname)
price_hist_fname
</pre>
</div>

<p>
<a href=""></a>
</p>



<div class="org-src-container">
<pre class="src src-python"><span style="color: #dcaeea;">data_price_len</span> = <span style="color: #c678dd;">len</span>(data.price)

<span style="color: #dcaeea;">lower_price_mask</span> = (data.price &lt;= <span style="color: #da8548; font-weight: bold;">10</span>)
<span style="color: #dcaeea;">low_price_len</span> = <span style="color: #c678dd;">len</span>(data[lower_price_mask])
<span style="color: #c678dd;">print</span>(<span style="color: #98be65;">"number of lower price mask"</span>, (low_price_len/data_price_len) * <span style="color: #da8548; font-weight: bold;">100</span>)

<span style="color: #dcaeea;">upper_price_mask</span> = (data.price &gt;= <span style="color: #da8548; font-weight: bold;">500</span>)
<span style="color: #dcaeea;">upper_price_len</span> = <span style="color: #c678dd;">len</span>(data[upper_price_mask])
<span style="color: #c678dd;">print</span>(<span style="color: #98be65;">"number of upper price mask"</span>, (upper_price_len/data_price_len) * <span style="color: #da8548; font-weight: bold;">100</span>)

<span style="color: #dcaeea;">filtered_price_data_upper_mask</span> = (data.price &lt; <span style="color: #da8548; font-weight: bold;">500</span>)
<span style="color: #dcaeea;">filtered_price_data_lower_mask</span> = (data.price &gt; <span style="color: #da8548; font-weight: bold;">10</span>)
<span style="color: #dcaeea;">filtered_price_mask</span> = filtered_price_data_upper_mask &amp; filtered_price_data_lower_mask
<span style="color: #dcaeea;">filtered_price_data</span> = (data[filtered_price_mask])

</pre>
</div>

<ul class="org-ul">
<li>there is 0.06% of data bellow 10$ and 2.52% of data price more than 500$ let&rsquo;s see histogram for filtered price data and raw price data.</li>
</ul>

<div class="org-src-container">
<pre class="src src-python">
plt.clf()
plt.hist(filtered_price_data.price, )
<span style="color: #dcaeea;">filtered_price_hist_plot</span> = plt.plot()
<span style="color: #dcaeea;">filtered_price_hist_fname</span> = <span style="color: #98be65;">'img/filtered_price_hist.png'</span>
plt.savefig(filtered_price_hist_fname)
filtered_price_hist_fname

</pre>
</div>

<p>
<a href=""></a>
</p>
</div>
</div>



<div id="outline-container-orgcf2147a" class="outline-4">
<h4 id="orgcf2147a"><span class="section-number-4">1.7.2.</span> minimum nights</h4>
<div class="outline-text-4" id="text-1-7-2">
<ul class="org-ul">
<li>lets plot minimum nights data and check it.</li>
</ul>


<div class="org-src-container">
<pre class="src src-python">
plt.clf()
plt.hist(data.minimum_nights)
<span style="color: #dcaeea;">minimum_nights_plot</span> = plt.plot()
<span style="color: #dcaeea;">minimum_nights_plot_fname</span> = <span style="color: #98be65;">'img/minimum_nights_plot.png'</span>
plt.savefig(minimum_nights_plot_fname)
minimum_nights_plot_fname


</pre>
</div>

<p>
<a href=""></a>
</p>




<div class="org-src-container">
<pre class="src src-python">
<span style="color: #dcaeea;">data_minimum_nights_len</span> = <span style="color: #c678dd;">len</span>(data.minimum_nights)

<span style="color: #dcaeea;">lower_minimum_nights_mask</span> = (data.minimum_nights &gt; <span style="color: #da8548; font-weight: bold;">30</span>)
<span style="color: #dcaeea;">lower_minimum_nights_len</span> = <span style="color: #c678dd;">len</span>(data[lower_minimum_nights_mask])
<span style="color: #c678dd;">print</span>(<span style="color: #98be65;">"number of upper minimum nights mask upper than 30"</span>, (lower_minimum_nights_len/data_minimum_nights_len) * <span style="color: #da8548; font-weight: bold;">100</span>,<span style="color: #98be65;">"%"</span>)

</pre>
</div>

<div class="org-src-container">
<pre class="src src-python">
<span style="color: #dcaeea;">filtered_minimum_nights_mask</span> = (data.minimum_nights &lt;= <span style="color: #da8548; font-weight: bold;">30</span>)
<span style="color: #dcaeea;">filtered_minimum_nights_data</span> = (data[filtered_minimum_nights_mask])

plt.clf()
plt.hist(filtered_minimum_nights_data.minimum_nights, bins=<span style="color: #da8548; font-weight: bold;">5</span>)
filtered_minimum_nights_plot = plt.plot()
filtered_minimum_nights_plot_fname = <span style="color: #98be65;">'img/filtered_minimum_nights_plot.png'</span>
plt.savefig(filtered_minimum_nights_plot_fname)
filtered_minimum_nights_plot_fname

</pre>
</div>

<p>
<a href=""></a>
</p>
</div>
</div>
</div>

<div id="outline-container-orgf2c60d0" class="outline-3">
<h3 id="orgf2c60d0"><span class="section-number-3">1.8.</span> Visual data</h3>
<div class="outline-text-3" id="text-1-8">
</div>
<div id="outline-container-org4d80b64" class="outline-4">
<h4 id="org4d80b64"><span class="section-number-4">1.8.1.</span> neighbourhood group</h4>
<div class="outline-text-4" id="text-1-8-1">
<div class="org-src-container">
<pre class="src src-python">
<span style="color: #c678dd;">print</span>(data.neighbourhood_group.value_counts()/<span style="color: #c678dd;">len</span>(data) * <span style="color: #da8548; font-weight: bold;">100</span>)

</pre>
</div>

<div class="org-src-container">
<pre class="src src-python">
plt.clf()
plt.hist(data.neighbourhood_group)
<span style="color: #dcaeea;">neighbourhood_group_plot_fname</span> = <span style="color: #98be65;">'img/neighbourhood_group_plot.png'</span>
plt.savefig(neighbourhood_group_plot_fname)
neighbourhood_group_plot_fname
</pre>
</div>

<p>
<a href=""></a>
</p>

<div class="org-src-container">
<pre class="src src-python">
plt.clf()
sns.scatterplot(data.longitude, data.latitude, hue=data.neighbourhood_group)
neighbourhood_group_location_plot_fname = <span style="color: #98be65;">'img/neighbourhood_group_location_plot.png'</span>
plt.savefig(neighbourhood_group_location_plot_fname)
neighbourhood_group_location_plot_fname

</pre>
</div>

<p>
<a href=""></a>
</p>
</div>
</div>

<div id="outline-container-org3be795f" class="outline-4">
<h4 id="org3be795f"><span class="section-number-4">1.8.2.</span> neighbourhood</h4>
<div class="outline-text-4" id="text-1-8-2">
<div class="org-src-container">
<pre class="src src-python">data.neighbourhood.value_counts()/<span style="color: #c678dd;">len</span>(data.neighbourhood)*<span style="color: #da8548; font-weight: bold;">100</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-python">
plt.clf()
plt.figure(figsize=(<span style="color: #da8548; font-weight: bold;">15</span>,<span style="color: #da8548; font-weight: bold;">15</span>))
sns.scatterplot(data.longitude,data.latitude,hue=data.neighbourhood)
neighbourhood_location_plot_fname = <span style="color: #98be65;">'img/neighbourhood_location_plot.png'</span>
plt.savefig(neighbourhood_location_plot_fname)
neighbourhood_location_plot_fname


</pre>
</div>

<p>
<a href=""></a>
</p>
</div>
</div>

<div id="outline-container-org92d4b7f" class="outline-4">
<h4 id="org92d4b7f"><span class="section-number-4">1.8.3.</span> room type</h4>
<div class="outline-text-4" id="text-1-8-3">
<div class="org-src-container">
<pre class="src src-python">
plt.clf()
sns.scatterplot(data.longitude,data.latitude,hue=data.room_type)
room_type_location_plot_fname = <span style="color: #98be65;">'img/room_type_location_plot.png'</span>
plt.savefig(room_type_location_plot_fname)
room_type_location_plot_fname
</pre>
</div>

<p>
<a href=""></a>
</p>


<div class="org-src-container">
<pre class="src src-python">
plt.clf()
plt.hist(data.room_type)
<span style="color: #dcaeea;">room_type_hist_plot_fname</span> = <span style="color: #98be65;">'img/room_type_hist_plot.png'</span>
plt.savefig(room_type_hist_plot_fname)
room_type_hist_plot_fname

</pre>
</div>

<p>
<a href=""></a>
</p>

<div class="org-src-container">
<pre class="src src-python">
<span style="color: #c678dd;">print</span>(data.room_type.value_counts()/<span style="color: #c678dd;">len</span>(data.room_type)*<span style="color: #da8548; font-weight: bold;">100</span>)

</pre>
</div>

<div class="org-src-container">
<pre class="src src-python">plt.clf()
sns.countplot(data = data, x = <span style="color: #98be65;">'room_type'</span>, hue = <span style="color: #98be65;">'neighbourhood_group'</span>)
room_type_on_neighbourhood_groups_fname = <span style="color: #98be65;">'img/room_type_on_neighbourhood_groups.png'</span>
plt.savefig(room_type_on_neighbourhood_groups_fname)
room_type_on_neighbourhood_groups_fname
</pre>
</div>

<p>
<a href=""></a>
</p>
</div>
</div>

<div id="outline-container-org4a1f8bc" class="outline-4">
<h4 id="org4a1f8bc"><span class="section-number-4">1.8.4.</span> availability 365</h4>
<div class="outline-text-4" id="text-1-8-4">
<div class="org-src-container">
<pre class="src src-python">
plt.clf()
sns.scatterplot(data.longitude,data.latitude,hue=data.availability_365)
availability_365_location_plot_fname = <span style="color: #98be65;">'img/availability_365_location_plot.png'</span>
plt.savefig(availability_365_location_plot_fname)
availability_365_location_plot_fname


</pre>
</div>

<p>
<a href=""></a>
</p>
</div>
</div>
</div>

<div id="outline-container-orgd52cd09" class="outline-3">
<h3 id="orgd52cd09"><span class="section-number-3">1.9.</span> Analysis hosts</h3>
<div class="outline-text-3" id="text-1-9">
<div class="org-src-container">
<pre class="src src-python">
<span style="color: #dcaeea;">top_hosts</span> = data.host_id.value_counts().head(<span style="color: #da8548; font-weight: bold;">20</span>)
<span style="color: #dcaeea;">top_hosts_data</span> = data[data.host_id.isin(top_hosts.index)]
top_hosts_data.<span style="color: #dcaeea;">host_id</span> = top_hosts_data.host_id.<span style="color: #c678dd;">apply</span>(<span style="color: #c678dd;">str</span>)

</pre>
</div>

<div class="org-src-container">
<pre class="src src-python">plt.clf()
plt.figure(figsize=(<span style="color: #da8548; font-weight: bold;">25</span>,<span style="color: #da8548; font-weight: bold;">15</span>))
sns.barplot(x = top_hosts.index, y = top_hosts.values)
top_hosts_plot_fname = <span style="color: #98be65;">'img/top_hosts_plot.png'</span>
plt.savefig(top_hosts_plot_fname)
top_hosts_plot_fname


</pre>
</div>

<p>
<a href=""></a>
</p>

<div class="org-src-container">
<pre class="src src-python">
plt.clf()
plt.figure(figsize=(<span style="color: #da8548; font-weight: bold;">15</span>,<span style="color: #da8548; font-weight: bold;">15</span>))
sns.scatterplot(top_hosts_data.longitude,top_hosts_data.latitude,hue=top_hosts_data.host_id, style=top_hosts_data.neighbourhood_group )
top_host_id_location_plot_fname = <span style="color: #98be65;">'img/top_host_id_location_plot.png'</span>
plt.savefig(top_host_id_location_plot_fname)
top_host_id_location_plot_fname




</pre>
</div>

<p>
<a href=""></a>
</p>

<div class="org-src-container">
<pre class="src src-python">
plt.clf()
sns.scatterplot(top_hosts_data.longitude,top_hosts_data.latitude,hue=top_hosts_data.price, style=top_hosts_data.neighbourhood_group )

top_host_id_location_price_plot_fname = <span style="color: #98be65;">'img/top_host_id_location_price_plot.png'</span>
plt.savefig(top_host_id_location_price_plot_fname)
top_host_id_location_price_plot_fname



</pre>
</div>

<p>
<a href=""></a>
</p>
</div>
</div>

<div id="outline-container-org88fec67" class="outline-3">
<h3 id="org88fec67"><span class="section-number-3">1.10.</span> Comments</h3>
<div class="outline-text-3" id="text-1-10">
<div class="org-src-container">
<pre class="src src-python">
<span style="color: #dcaeea;">most_reviews</span> = data.number_of_reviews.sort_values().tail(<span style="color: #da8548; font-weight: bold;">20</span>)
<span style="color: #dcaeea;">most_reviews_data</span> = data[data.number_of_reviews.isin(most_reviews)]

</pre>
</div>

<div class="org-src-container">
<pre class="src src-python">

plt.clf()
sns.scatterplot(most_reviews_data.longitude,most_reviews_data.latitude,hue=most_reviews_data.price, style=most_reviews_data.neighbourhood_group, s=<span style="color: #da8548; font-weight: bold;">200</span>)

most_reviews_data_location_price_plot_fname = <span style="color: #98be65;">'img/most_reviews_data_location_price_plot.png'</span>
plt.savefig(most_reviews_data_location_price_plot_fname)
most_reviews_data_location_price_plot_fname




</pre>
</div>

<p>
<a href=""></a>
</p>




<div class="org-src-container">
<pre class="src src-python">
plt.clf()
plt.figure(figsize=(<span style="color: #da8548; font-weight: bold;">10</span>,<span style="color: #da8548; font-weight: bold;">8</span>))
<span style="color: #5B6268;">#</span><span style="color: #5B6268;">loading the png NYC image found on Google and saving to my local folder along with the project</span>
i=<span style="color: #98be65;">'img/Neighbourhoods_New_York_City_Map.png'</span>
nyc_img=plt.imread(i)
<span style="color: #5B6268;">#</span><span style="color: #5B6268;">scaling the image based on the latitude and longitude max and mins for proper output</span>
plt.imshow(nyc_img,zorder=<span style="color: #da8548; font-weight: bold;">0</span>,extent=[-<span style="color: #da8548; font-weight: bold;">74.258</span>, -<span style="color: #da8548; font-weight: bold;">73.7</span>, <span style="color: #da8548; font-weight: bold;">40.49</span>,<span style="color: #da8548; font-weight: bold;">40.92</span>])
ax=plt.gca()
<span style="color: #5B6268;">#</span><span style="color: #5B6268;">using scatterplot again</span>
sns.scatterplot(most_reviews_data.longitude,most_reviews_data.latitude,hue=most_reviews_data.price,  ax=ax,style=most_reviews_data.number_of_reviews, s=<span style="color: #da8548; font-weight: bold;">150</span> )
most_reviews_location_on_map_plot_fname = <span style="color: #98be65;">'img/most_reviews_location_on_map_plot.png'</span>
plt.savefig(most_reviews_location_on_map_plot_fname)
most_reviews_location_on_map_plot_fname



</pre>
</div>

<p>
<a href=""></a>
</p>
</div>
</div>

<div id="outline-container-org2eea255" class="outline-3">
<h3 id="org2eea255"><span class="section-number-3">1.11.</span> Hypothesis Tests</h3>
<div class="outline-text-3" id="text-1-11">
</div>
<div id="outline-container-org3cec0d8" class="outline-4">
<h4 id="org3cec0d8"><span class="section-number-4">1.11.1.</span> Manhattan price distribution is normal</h4>
<div class="outline-text-4" id="text-1-11-1">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #dcaeea;">Manhattan</span> = data[data.neighbourhood_group == <span style="color: #98be65;">'Manhattan'</span>]
manhattan_data = Manhattan.price
<span style="color: #dcaeea;">stat</span>, <span style="color: #dcaeea;">p</span> = shapiro(manhattan_data)
<span style="color: #c678dd;">print</span>(<span style="color: #98be65;">'stat=%.3f, p=%.3f'</span> % (stat, p))
<span style="color: #51afef;">if</span> p &gt; <span style="color: #da8548; font-weight: bold;">0.05</span>:
    <span style="color: #c678dd;">print</span>(<span style="color: #98be65;">'Probably Gaussian'</span>)
<span style="color: #51afef;">else</span>:
    <span style="color: #c678dd;">print</span>(<span style="color: #98be65;">'Probably not Gaussian'</span>)
</pre>
</div>
</div>
</div>

<div id="outline-container-org59cc957" class="outline-4">
<h4 id="org59cc957"><span class="section-number-4">1.11.2.</span> Staten Island price distribution is normal</h4>
<div class="outline-text-4" id="text-1-11-2">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #dcaeea;">Staten_Island</span> = data[data.neighbourhood_group == <span style="color: #98be65;">'Staten Island'</span>]
staten_data = Staten_Island.price
<span style="color: #dcaeea;">stat</span>, <span style="color: #dcaeea;">p</span> = shapiro(staten_data)
<span style="color: #c678dd;">print</span>(<span style="color: #98be65;">'stat=%.3f, p=%.3f'</span> % (stat, p))
<span style="color: #51afef;">if</span> p &gt; <span style="color: #da8548; font-weight: bold;">0.05</span>:
    <span style="color: #c678dd;">print</span>(<span style="color: #98be65;">'Probably Gaussian'</span>)
<span style="color: #51afef;">else</span>:
    <span style="color: #c678dd;">print</span>(<span style="color: #98be65;">'Probably not Gaussian'</span>)


</pre>
</div>
</div>
</div>

<div id="outline-container-orgc70a56d" class="outline-4">
<h4 id="orgc70a56d"><span class="section-number-4">1.11.3.</span> top hosts and top host based on reviews are the same</h4>
<div class="outline-text-4" id="text-1-11-3">
<div class="org-src-container">
<pre class="src src-python">

<span style="color: #dcaeea;">stat</span>, <span style="color: #dcaeea;">p</span> = pearsonr(top_hosts.index, most_reviews_data.host_id)
<span style="color: #c678dd;">print</span>(<span style="color: #98be65;">'stat=%.3f, p=%.3f'</span> % (stat, p))
<span style="color: #51afef;">if</span> p &gt; <span style="color: #da8548; font-weight: bold;">0.05</span>:
    <span style="color: #c678dd;">print</span>(<span style="color: #98be65;">'Probably independent'</span>)
<span style="color: #51afef;">else</span>:
    <span style="color: #c678dd;">print</span>(<span style="color: #98be65;">'Probably dependent'</span>)


</pre>
</div>
</div>
</div>

<div id="outline-container-org107be31" class="outline-4">
<h4 id="org107be31"><span class="section-number-4">1.11.4.</span> People spend same amount of money on Manhattan and Brooklyn</h4>
<div class="outline-text-4" id="text-1-11-4">
<div class="org-src-container">
<pre class="src src-python">
<span style="color: #dcaeea;">Manhattan</span> = data[data.neighbourhood_group == <span style="color: #98be65;">'Manhattan'</span>]
manhattan = Manhattan.sample(<span style="color: #da8548; font-weight: bold;">20104</span>)
Brooklyn = data[data.neighbourhood_group == <span style="color: #98be65;">'Brooklyn'</span>]
<span style="color: #dcaeea;">stat</span>, <span style="color: #dcaeea;">p</span> = pearsonr(manhattan.price, Brooklyn.price)

<span style="color: #c678dd;">print</span>(<span style="color: #98be65;">'stat=%.3f, p=%.3f'</span> % (stat, p))
<span style="color: #51afef;">if</span> p &gt; <span style="color: #da8548; font-weight: bold;">0.05</span>:
    <span style="color: #c678dd;">print</span>(<span style="color: #98be65;">'Probably independent'</span>)
<span style="color: #51afef;">else</span>:
    <span style="color: #c678dd;">print</span>(<span style="color: #98be65;">'Probably dependent'</span>)


</pre>
</div>
</div>
</div>

<div id="outline-container-org41de14b" class="outline-4">
<h4 id="org41de14b"><span class="section-number-4">1.11.5.</span> relation between all year availability with price</h4>
<div class="outline-text-4" id="text-1-11-5">
<div class="org-src-container">
<pre class="src src-python">
<span style="color: #51afef;">from</span> scipy.stats <span style="color: #51afef;">import</span> ttest_rel

<span style="color: #51afef;">def</span> <span style="color: #c678dd;">add_all_year_availability</span>(availability_365):

    <span style="color: #51afef;">if</span> availability_365 == <span style="color: #da8548; font-weight: bold;">365</span>:
        <span style="color: #51afef;">return</span> <span style="color: #da8548; font-weight: bold;">1</span>
    <span style="color: #51afef;">return</span> <span style="color: #da8548; font-weight: bold;">0</span>

data[<span style="color: #98be65;">'All_Year_Availability'</span>] = data.availability_365.<span style="color: #c678dd;">apply</span>(add_all_year_availability)
<span style="color: #c678dd;">print</span>(ttest_rel(data.All_Year_Availability, data.price))



</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org8c8c72c" class="outline-3">
<h3 id="org8c8c72c"><span class="section-number-3">1.12.</span> Predict Price</h3>
<div class="outline-text-3" id="text-1-12">
</div>
<div id="outline-container-org501cda0" class="outline-4">
<h4 id="org501cda0"><span class="section-number-4">1.12.1.</span> Prepare Data for model</h4>
<div class="outline-text-4" id="text-1-12-1">
</div>
<ol class="org-ol">
<li><a id="org57d424d"></a>clean price data<br />
<div class="outline-text-5" id="text-1-12-1-1">
<div class="org-src-container">
<pre class="src src-python">
<span style="color: #dcaeea;">model_data</span> = data[data[<span style="color: #98be65;">'price'</span>]&lt;= data[<span style="color: #98be65;">'price'</span>].mean() + <span style="color: #da8548; font-weight: bold;">3</span>*data[<span style="color: #98be65;">'price'</span>].std()]

</pre>
</div>
</div>
</li>
<li><a id="org951d1b6"></a>drop columns that are not necessary for model training<br />
<div class="outline-text-5" id="text-1-12-1-2">
<div class="org-src-container">
<pre class="src src-python">
<span style="color: #dcaeea;">model_data</span> = data.drop([<span style="color: #98be65;">'host_id'</span>, <span style="color: #98be65;">'latitude'</span>,<span style="color: #98be65;">'longitude'</span>,<span style="color: #98be65;">'neighbourhood'</span>,<span style="color: #98be65;">'number_of_reviews'</span>,<span style="color: #98be65;">'reviews_per_month'</span>,<span style="color: #98be65;">'name'</span>,<span style="color: #98be65;">'id'</span>,<span style="color: #98be65;">'host_name'</span>,<span style="color: #98be65;">'last_review'</span>, <span style="color: #98be65;">'All_Year_Availability'</span>], axis=<span style="color: #da8548; font-weight: bold;">1</span>)

</pre>
</div>
</div>
</li>

<li><a id="orga3b53be"></a>Encode data<br />
<div class="outline-text-5" id="text-1-12-1-3">
<div class="org-src-container">
<pre class="src src-python">
<span style="color: #51afef;">def</span> <span style="color: #c678dd;">encode</span>(data):
    <span style="color: #51afef;">for</span> column <span style="color: #51afef;">in</span> data.columns[data.columns.isin([<span style="color: #98be65;">'neighbourhood_group'</span>, <span style="color: #98be65;">'room_type'</span>])]:
        <span style="color: #dcaeea;">data</span>[<span style="color: #dcaeea;">column</span>] = data[column].factorize()[<span style="color: #da8548; font-weight: bold;">0</span>]
    <span style="color: #51afef;">return</span> data

<span style="color: #dcaeea;">model_data_encoded</span> = encode(model_data.copy())

</pre>
</div>
</div>
</li>
</ol>
</div>
<div id="outline-container-orgfc5a21b" class="outline-4">
<h4 id="orgfc5a21b"><span class="section-number-4">1.12.2.</span> spilit data</h4>
<div class="outline-text-4" id="text-1-12-2">
</div>
<ol class="org-ol">
<li><a id="org81b140c"></a>set data to X , Y<br />
<div class="outline-text-5" id="text-1-12-2-1">
<ul class="org-ul">
<li>we use neighbourhood group  room type  minimum nights  calculated host listings count  availability 365 to predict price</li>
</ul>

<div class="org-src-container">
<pre class="src src-python">
<span style="color: #dcaeea;">x</span> = model_data_encoded.iloc[:,[<span style="color: #da8548; font-weight: bold;">0</span>,<span style="color: #da8548; font-weight: bold;">1</span>,<span style="color: #da8548; font-weight: bold;">3</span>,<span style="color: #da8548; font-weight: bold;">4</span>,<span style="color: #da8548; font-weight: bold;">5</span>]]
<span style="color: #dcaeea;">y</span> = model_data_encoded.iloc[:,[<span style="color: #da8548; font-weight: bold;">2</span>]]


</pre>
</div>
</div>
</li>

<li><a id="org6188e9d"></a>set data to training and test<br />
<div class="outline-text-5" id="text-1-12-2-2">
<div class="org-src-container">
<pre class="src src-python">
<span style="color: #dcaeea;">x_train</span>,<span style="color: #dcaeea;">x_test</span>,<span style="color: #dcaeea;">y_train</span>,<span style="color: #dcaeea;">y_test</span>=train_test_split(x,y,test_size=.<span style="color: #da8548; font-weight: bold;">1</span>,random_state=<span style="color: #da8548; font-weight: bold;">353</span>)


</pre>
</div>
</div>
</li>
</ol>
</div>

<div id="outline-container-org7d5e074" class="outline-4">
<h4 id="org7d5e074"><span class="section-number-4">1.12.3.</span> model</h4>
<div class="outline-text-4" id="text-1-12-3">
</div>
<ol class="org-ol">
<li><a id="org4cea0c3"></a>fit model<br />
<div class="outline-text-5" id="text-1-12-3-1">
<div class="org-src-container">
<pre class="src src-python">
<span style="color: #dcaeea;">linear_model</span> = LinearRegression()
linear_model.fit(x_train,y_train)


</pre>
</div>
</div>
</li>

<li><a id="org32d9c06"></a>test model<br />
<div class="outline-text-5" id="text-1-12-3-2">
<div class="org-src-container">
<pre class="src src-python">
<span style="color: #dcaeea;">y_pred</span> = linear_model.predict(x_test)
r2_score(y_test,y_pred)

</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>









<div id="outline-container-orgdefbc62" class="outline-2">
<h2 id="orgdefbc62"><span class="section-number-2">2.</span> Apartment rental offers in Germany</h2>
<div class="outline-text-2" id="text-2">
</div>

<div id="outline-container-orge2b440f" class="outline-3">
<h3 id="orge2b440f"><span class="section-number-3">2.1.</span> import libraries</h3>
<div class="outline-text-3" id="text-2-1">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #51afef;">import</span> time
<span style="color: #51afef;">import</span> warnings
<span style="color: #51afef;">import</span> pandas <span style="color: #51afef;">as</span> pd
<span style="color: #51afef;">import</span> numpy <span style="color: #51afef;">as</span> np
<span style="color: #51afef;">import</span> matplotlib.pyplot <span style="color: #51afef;">as</span> plt
<span style="color: #51afef;">import</span> seaborn <span style="color: #51afef;">as</span> sns
<span style="color: #51afef;">from</span> sklearn.linear_model <span style="color: #51afef;">import</span> LinearRegression
<span style="color: #51afef;">from</span> sklearn.model_selection <span style="color: #51afef;">import</span> train_test_split
<span style="color: #51afef;">from</span> sklearn.metrics <span style="color: #51afef;">import</span> r2_score
<span style="color: #51afef;">import</span> multiprocessing <span style="color: #51afef;">as</span> mp
<span style="color: #51afef;">import</span> dask
<span style="color: #51afef;">import</span> dask.dataframe <span style="color: #51afef;">as</span> dd

</pre>
</div>
</div>
</div>


<div id="outline-container-org79d744a" class="outline-3">
<h3 id="org79d744a"><span class="section-number-3">2.2.</span> config packages</h3>
<div class="outline-text-3" id="text-2-2">
<div class="org-src-container">
<pre class="src src-python">warnings.filterwarnings(<span style="color: #98be65;">"ignore"</span>)

<span style="color: #5B6268;">#</span><span style="color: #5B6268;">pd.set_option("display.max_columns", None)</span>
<span style="color: #5B6268;">#</span><span style="color: #5B6268;">pd.set_option("display.max_rows", None)</span>
</pre>
</div>
</div>
</div>


<div id="outline-container-org0f732f3" class="outline-3">
<h3 id="org0f732f3"><span class="section-number-3">2.3.</span> read data</h3>
<div class="outline-text-3" id="text-2-3">
<div class="org-src-container">
<pre class="src src-python">
<span style="color: #dcaeea;">raw_data</span> = pd.read_csv(<span style="color: #98be65;">'immo_data.csv'</span>)
raw_data.info()

</pre>
</div>

<pre class="example" id="org59ba4b8">
 &lt;class 'pandas.core.frame.DataFrame'&gt;
 RangeIndex: 268850 entries, 0 to 268849
 Data columns (total 49 columns):
  #   Column                    Non-Null Count   Dtype  
 ---  ------                    --------------   -----  
  0   regio1                    268850 non-null  object 
  1   serviceCharge             261941 non-null  float64
  2   heatingType               223994 non-null  object 
  3   telekomTvOffer            236231 non-null  object 
  4   telekomHybridUploadSpeed  45020 non-null   float64
  5   newlyConst                268850 non-null  bool   
  6   balcony                   268850 non-null  bool   
  7   picturecount              268850 non-null  int64  
  8   pricetrend                267018 non-null  float64
  9   telekomUploadSpeed        235492 non-null  float64
  10  totalRent                 228333 non-null  float64
  11  yearConstructed           211805 non-null  float64
  12  scoutId                   268850 non-null  int64  
  13  noParkSpaces              93052 non-null   float64
  14  firingTypes               211886 non-null  object 
  15  hasKitchen                268850 non-null  bool   
  16  geo_bln                   268850 non-null  object 
  17  cellar                    268850 non-null  bool   
  18  yearConstructedRange      211805 non-null  float64
  19  baseRent                  268850 non-null  float64
  20  houseNumber               197832 non-null  object 
  21  livingSpace               268850 non-null  float64
  22  geo_krs                   268850 non-null  object 
  23  condition                 200361 non-null  object 
  24  interiorQual              156185 non-null  object 
  25  petsAllowed               154277 non-null  object 
  26  street                    268850 non-null  object 
  27  streetPlain               197837 non-null  object 
  28  lift                      268850 non-null  bool   
  29  baseRentRange             268850 non-null  int64  
  30  typeOfFlat                232236 non-null  object 
  31  geo_plz                   268850 non-null  int64  
  32  noRooms                   268850 non-null  float64
  33  thermalChar               162344 non-null  float64
  34  floor                     217541 non-null  float64
  35  numberOfFloors            171118 non-null  float64
  36  noRoomsRange              268850 non-null  int64  
  37  garden                    268850 non-null  bool   
  38  livingSpaceRange          268850 non-null  int64  
  39  regio2                    268850 non-null  object 
  40  regio3                    268850 non-null  object 
  41  description               249103 non-null  object 
  42  facilities                215926 non-null  object 
  43  heatingCosts              85518 non-null   float64
  44  energyEfficiencyClass     77787 non-null   object 
  45  lastRefurbish             80711 non-null   float64
  46  electricityBasePrice      46846 non-null   float64
  47  electricityKwhPrice       46846 non-null   float64
  48  date                      268850 non-null  object 
 dtypes: bool(6), float64(18), int64(6), object(19)
 memory usage: 89.7+ MB
</pre>
</div>
</div>

<div id="outline-container-org3dbf95e" class="outline-3">
<h3 id="org3dbf95e"><span class="section-number-3">2.4.</span> handling missing values &amp; cleaning data</h3>
<div class="outline-text-3" id="text-2-4">
</div>
<div id="outline-container-orgb620f8c" class="outline-4">
<h4 id="orgb620f8c"><span class="section-number-4">2.4.1.</span> null data</h4>
<div class="outline-text-4" id="text-2-4-1">
<div class="org-src-container">
<pre class="src src-python">
<span style="color: #c678dd;">print</span>(raw_data.isnull().<span style="color: #c678dd;">sum</span>())

</pre>
</div>

<pre class="example" id="org58ecc11">
regio1                           0
serviceCharge                 6909
heatingType                  44856
telekomTvOffer               32619
telekomHybridUploadSpeed    223830
newlyConst                       0
balcony                          0
picturecount                     0
pricetrend                    1832
telekomUploadSpeed           33358
totalRent                    40517
yearConstructed              57045
scoutId                          0
noParkSpaces                175798
firingTypes                  56964
hasKitchen                       0
geo_bln                          0
cellar                           0
yearConstructedRange         57045
baseRent                         0
houseNumber                  71018
livingSpace                      0
geo_krs                          0
condition                    68489
interiorQual                112665
petsAllowed                 114573
street                           0
streetPlain                  71013
lift                             0
baseRentRange                    0
typeOfFlat                   36614
geo_plz                          0
noRooms                          0
thermalChar                 106506
floor                        51309
numberOfFloors               97732
noRoomsRange                     0
garden                           0
livingSpaceRange                 0
regio2                           0
regio3                           0
description                  19747
facilities                   52924
heatingCosts                183332
energyEfficiencyClass       191063
lastRefurbish               188139
electricityBasePrice        222004
electricityKwhPrice         222004
date                             0
dtype: int64
</pre>

<div class="org-src-container">
<pre class="src src-python">
<span style="color: #c678dd;">print</span>(raw_data.isnull().<span style="color: #c678dd;">sum</span>()/<span style="color: #c678dd;">len</span>(raw_data))


</pre>
</div>

<pre class="example" id="orgab353ca">
regio1                      0.000000
serviceCharge               0.025698
heatingType                 0.166844
telekomTvOffer              0.121328
telekomHybridUploadSpeed    0.832546
newlyConst                  0.000000
balcony                     0.000000
picturecount                0.000000
pricetrend                  0.006814
telekomUploadSpeed          0.124077
totalRent                   0.150705
yearConstructed             0.212182
scoutId                     0.000000
noParkSpaces                0.653889
firingTypes                 0.211880
hasKitchen                  0.000000
geo_bln                     0.000000
cellar                      0.000000
yearConstructedRange        0.212182
baseRent                    0.000000
houseNumber                 0.264155
livingSpace                 0.000000
geo_krs                     0.000000
condition                   0.254748
interiorQual                0.419063
petsAllowed                 0.426160
street                      0.000000
streetPlain                 0.264136
lift                        0.000000
baseRentRange               0.000000
typeOfFlat                  0.136187
geo_plz                     0.000000
noRooms                     0.000000
thermalChar                 0.396154
floor                       0.190846
numberOfFloors              0.363519
noRoomsRange                0.000000
garden                      0.000000
livingSpaceRange            0.000000
regio2                      0.000000
regio3                      0.000000
description                 0.073450
facilities                  0.196853
heatingCosts                0.681912
energyEfficiencyClass       0.710668
lastRefurbish               0.699792
electricityBasePrice        0.825754
electricityKwhPrice         0.825754
date                        0.000000
dtype: float64
</pre>
</div>
</div>

<div id="outline-container-orgd712060" class="outline-4">
<h4 id="orgd712060"><span class="section-number-4">2.4.2.</span> delete columns with more than %50 missing values</h4>
<div class="outline-text-4" id="text-2-4-2">
<div class="org-src-container">
<pre class="src src-python">
<span style="color: #dcaeea;">raw_data</span> = raw_data.drop(columns=raw_data.columns[((raw_data.isnull().<span style="color: #c678dd;">sum</span>()/<span style="color: #c678dd;">len</span>(raw_data)) &gt; <span style="color: #da8548; font-weight: bold;">0.50</span>)])

raw_data.columns


</pre>
</div>

<pre class="example" id="org9185f21">
Index(['regio1', 'serviceCharge', 'heatingType', 'telekomTvOffer',
       'newlyConst', 'balcony', 'picturecount', 'pricetrend',
       'telekomUploadSpeed', 'totalRent', 'yearConstructed', 'scoutId',
       'firingTypes', 'hasKitchen', 'geo_bln', 'cellar',
       'yearConstructedRange', 'baseRent', 'houseNumber', 'livingSpace',
       'geo_krs', 'condition', 'interiorQual', 'petsAllowed', 'street',
       'streetPlain', 'lift', 'baseRentRange', 'typeOfFlat', 'geo_plz',
       'noRooms', 'thermalChar', 'floor', 'numberOfFloors', 'noRoomsRange',
       'garden', 'livingSpaceRange', 'regio2', 'regio3', 'description',
       'facilities', 'date'],
      dtype='object')
</pre>
</div>
</div>

<div id="outline-container-org7ca1f50" class="outline-4">
<h4 id="org7ca1f50"><span class="section-number-4">2.4.3.</span> delete columns that are not usefull</h4>
<div class="outline-text-4" id="text-2-4-3">
<div class="org-src-container">
<pre class="src src-python">
<span style="color: #dcaeea;">raw_data</span> = raw_data.drop(columns=[<span style="color: #98be65;">'livingSpaceRange'</span>,<span style="color: #98be65;">'street'</span>,<span style="color: #98be65;">'description'</span>,<span style="color: #98be65;">'facilities'</span>,<span style="color: #98be65;">'geo_krs'</span>,<span style="color: #98be65;">'geo_plz'</span>,<span style="color: #98be65;">'scoutId'</span>,<span style="color: #98be65;">'regio1'</span>,<span style="color: #98be65;">'telekomUploadSpeed'</span>,<span style="color: #98be65;">'telekomTvOffer'</span>,<span style="color: #98be65;">'pricetrend'</span>,<span style="color: #98be65;">'regio3'</span>,<span style="color: #98be65;">'noRoomsRange'</span>,<span style="color: #98be65;">'picturecount'</span>,<span style="color: #98be65;">'geo_bln'</span>,<span style="color: #98be65;">'date'</span>,<span style="color: #98be65;">'houseNumber'</span>,<span style="color: #98be65;">'streetPlain'</span>,<span style="color: #98be65;">'firingTypes'</span>,<span style="color: #98be65;">'yearConstructedRange'</span>])


</pre>
</div>

<div class="org-src-container">
<pre class="src src-python">
raw_data.info()

</pre>
</div>

<pre class="example" id="org3bd4bf6">
&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 268850 entries, 0 to 268849
Data columns (total 22 columns):
 #   Column           Non-Null Count   Dtype  
---  ------           --------------   -----  
 0   serviceCharge    261941 non-null  float64
 1   heatingType      223994 non-null  object 
 2   newlyConst       268850 non-null  bool   
 3   balcony          268850 non-null  bool   
 4   totalRent        228333 non-null  float64
 5   yearConstructed  211805 non-null  float64
 6   hasKitchen       268850 non-null  bool   
 7   cellar           268850 non-null  bool   
 8   baseRent         268850 non-null  float64
 9   livingSpace      268850 non-null  float64
 10  condition        200361 non-null  object 
 11  interiorQual     156185 non-null  object 
 12  petsAllowed      154277 non-null  object 
 13  lift             268850 non-null  bool   
 14  baseRentRange    268850 non-null  int64  
 15  typeOfFlat       232236 non-null  object 
 16  noRooms          268850 non-null  float64
 17  thermalChar      162344 non-null  float64
 18  floor            217541 non-null  float64
 19  numberOfFloors   171118 non-null  float64
 20  garden           268850 non-null  bool   
 21  regio2           268850 non-null  object 
dtypes: bool(6), float64(9), int64(1), object(6)
memory usage: 34.4+ MB
</pre>
</div>
</div>


<div id="outline-container-orgeae3715" class="outline-4">
<h4 id="orgeae3715"><span class="section-number-4">2.4.4.</span> delete unusal data</h4>
<div class="outline-text-4" id="text-2-4-4">
</div>
<ol class="org-ol">
<li><a id="org49edfff"></a>livingspace<br />
<div class="outline-text-5" id="text-2-4-4-1">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #dcaeea;">unusal_livingspace_data</span> = raw_data[raw_data.livingSpace == <span style="color: #da8548; font-weight: bold;">0</span>]
raw_data.drop(unusal_livingspace_data.index,axis=<span style="color: #da8548; font-weight: bold;">0</span>, inplace=<span style="color: #a9a1e1;">True</span>)
</pre>
</div>
</div>
</li>


<li><a id="org633a5cd"></a>totalrent<br />
<div class="outline-text-5" id="text-2-4-4-2">
<div class="org-src-container">
<pre class="src src-python">
<span style="color: #dcaeea;">unusal_totalrent_data</span> = raw_data[raw_data.totalRent == <span style="color: #da8548; font-weight: bold;">0</span>]
raw_data.drop(unusal_totalrent_data.index,axis=<span style="color: #da8548; font-weight: bold;">0</span>, inplace=<span style="color: #a9a1e1;">True</span>)

</pre>
</div>
</div>
</li>


<li><a id="orgcf02cbb"></a>baseRent<br />
<div class="outline-text-5" id="text-2-4-4-3">
<div class="org-src-container">
<pre class="src src-python">
<span style="color: #dcaeea;">unusal_baseRent_data</span> = raw_data[raw_data.baseRent == <span style="color: #da8548; font-weight: bold;">0</span>]
raw_data.drop(unusal_baseRent_data.index,axis=<span style="color: #da8548; font-weight: bold;">0</span>, inplace=<span style="color: #a9a1e1;">True</span>)


</pre>
</div>
</div>
</li>
</ol>
</div>



<div id="outline-container-org32dbc30" class="outline-4">
<h4 id="org32dbc30"><span class="section-number-4">2.4.5.</span> fill numeric data with mean</h4>
<div class="outline-text-4" id="text-2-4-5">
<div class="org-src-container">
<pre class="src src-python">
<span style="color: #dcaeea;">data</span> = raw_data.fillna(raw_data._get_numeric_data().mean())

<span style="color: #c678dd;">print</span>(data.isnull().<span style="color: #c678dd;">sum</span>())

</pre>
</div>

<pre class="example" id="org2355dcd">
serviceCharge           0
heatingType         44809
newlyConst              0
balcony                 0
totalRent               0
yearConstructed         0
hasKitchen              0
cellar                  0
baseRent                0
livingSpace             0
condition           68310
interiorQual       112441
petsAllowed        114369
lift                    0
baseRentRange           0
typeOfFlat          36585
noRooms                 0
thermalChar             0
floor                   0
numberOfFloors          0
garden                  0
regio2                  0
dtype: int64
</pre>
</div>
</div>


<div id="outline-container-org8ba2594" class="outline-4">
<h4 id="org8ba2594"><span class="section-number-4">2.4.6.</span> categorical data with lots of states</h4>
<div class="outline-text-4" id="text-2-4-6">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #51afef;">def</span> <span style="color: #c678dd;">get_categorical_data</span>(data):
    <span style="color: #dcaeea;">categorical_cols</span> = []
    <span style="color: #51afef;">for</span> col <span style="color: #51afef;">in</span> data.columns:
        <span style="color: #51afef;">if</span> data[col].dtype == <span style="color: #98be65;">'object'</span> <span style="color: #51afef;">or</span> data[col].dtype == <span style="color: #98be65;">'bool'</span>:
            categorical_cols.append(col)
            <span style="color: #c678dd;">print</span>(f<span style="color: #98be65;">'col : </span>{col}<span style="color: #98be65;"> , unique values : </span>{data[col].nunique()}<span style="color: #98be65;">'</span>)
    <span style="color: #51afef;">return</span> categorical_cols


get_categorical_data(data)


<span style="color: #51afef;">def</span> <span style="color: #c678dd;">get_crowded_categorical_data_columns</span>(data):
    list_of_crowded_cols = []
    <span style="color: #51afef;">for</span> col <span style="color: #51afef;">in</span> data.columns:
        <span style="color: #51afef;">if</span> data[col].dtype == <span style="color: #98be65;">'object'</span> <span style="color: #51afef;">or</span> data[col].dtype == <span style="color: #98be65;">'bool'</span>:
            <span style="color: #51afef;">if</span> data[col].nunique() &gt; <span style="color: #da8548; font-weight: bold;">5</span>:
                list_of_crowded_cols.append(col)
    <span style="color: #51afef;">return</span> list_of_crowded_cols

</pre>
</div>

<pre class="example" id="org58e840d">
col : heatingType , unique values : 13
col : newlyConst , unique values : 2
col : balcony , unique values : 2
col : hasKitchen , unique values : 2
col : cellar , unique values : 2
col : condition , unique values : 10
col : interiorQual , unique values : 4
col : petsAllowed , unique values : 3
col : lift , unique values : 2
col : typeOfFlat , unique values : 10
col : garden , unique values : 2
col : regio2 , unique values : 419
</pre>
</div>
</div>


<div id="outline-container-orgc6a17d8" class="outline-4">
<h4 id="orgc6a17d8"><span class="section-number-4">2.4.7.</span> fill categorical data with other</h4>
<div class="outline-text-4" id="text-2-4-7">
<div class="org-src-container">
<pre class="src src-python">
<span style="color: #dcaeea;">categorical_cols</span> = get_categorical_data(data)
<span style="color: #dcaeea;">crowded_cols</span> = get_crowded_categorical_data_columns(data)
<span style="color: #c678dd;">print</span>(cols)
</pre>
</div>

<div class="org-src-container">
<pre class="src src-python">
<span style="color: #51afef;">for</span> col <span style="color: #51afef;">in</span> categorical_cols:
    data[col].fillna(<span style="color: #98be65;">"other"</span>, inplace=<span style="color: #a9a1e1;">True</span>)

</pre>
</div>

<div class="org-src-container">
<pre class="src src-python">
<span style="color: #c678dd;">print</span>(data.isnull().<span style="color: #c678dd;">sum</span>())

</pre>
</div>

<pre class="example" id="orgb8644e8">
serviceCharge      0
heatingType        0
newlyConst         0
balcony            0
totalRent          0
yearConstructed    0
hasKitchen         0
cellar             0
baseRent           0
livingSpace        0
condition          0
interiorQual       0
petsAllowed        0
lift               0
baseRentRange      0
typeOfFlat         0
noRooms            0
thermalChar        0
floor              0
numberOfFloors     0
garden             0
regio2             0
dtype: int64
</pre>
</div>
</div>

<div id="outline-container-org448a119" class="outline-4">
<h4 id="org448a119"><span class="section-number-4">2.4.8.</span> reduce number of categories</h4>
<div class="outline-text-4" id="text-2-4-8">
<div class="org-src-container">
<pre class="src src-python">
get_categorical_data(data)
<span style="color: #dcaeea;">crowded_cols</span> = get_crowded_categorical_data_columns(data)
<span style="color: #c678dd;">print</span>(crowded_cols)






</pre>
</div>

<pre class="example" id="org988c85a">
col : heatingType , unique values : 14
col : newlyConst , unique values : 2
col : balcony , unique values : 2
col : hasKitchen , unique values : 2
col : cellar , unique values : 2
col : condition , unique values : 11
col : interiorQual , unique values : 5
col : petsAllowed , unique values : 4
col : lift , unique values : 2
col : typeOfFlat , unique values : 10
col : garden , unique values : 2
col : regio2 , unique values : 419
['heatingType', 'condition', 'typeOfFlat', 'regio2']
</pre>
</div>

<ol class="org-ol">
<li><a id="org72d61f3"></a>reduce category func<br />
<div class="outline-text-5" id="text-2-4-8-1">
<div class="org-src-container">
<pre class="src src-python">

<span style="color: #51afef;">def</span> <span style="color: #c678dd;">reduce_category</span>(cat):

    <span style="color: #51afef;">if</span> cat <span style="color: #51afef;">in</span> change_to_other:
        <span style="color: #51afef;">return</span> <span style="color: #98be65;">'other'</span>
    <span style="color: #51afef;">return</span> cat





</pre>
</div>
</div>
</li>

<li><a id="org32dfa4e"></a>heatingType<br />
<div class="outline-text-5" id="text-2-4-8-2">
<div class="org-src-container">
<pre class="src src-python">
<span style="color: #c678dd;">print</span>(data.heatingType.value_counts()/<span style="color: #c678dd;">len</span>(data.heatingType)*<span style="color: #da8548; font-weight: bold;">100</span>)
</pre>
</div>

<pre class="example" id="org8d378f1">
central_heating                   47.956569
other                             16.690505
district_heating                   9.233061
gas_heating                        7.428763
self_contained_central_heating     7.094647
floor_heating                      6.587328
oil_heating                        1.876932
heat_pump                          1.017618
combined_heat_and_power_plant      0.736395
night_storage_heater               0.496517
wood_pellet_heating                0.357954
electric_heating                   0.334861
stove_heating                      0.127016
solar_heating                      0.061832
Name: heatingType, dtype: float64
</pre>


<div class="org-src-container">
<pre class="src src-python">
<span style="color: #dcaeea;">change_to_other</span> = data.heatingType.value_counts().tail().index
data.<span style="color: #dcaeea;">heatingType</span> = data.heatingType.<span style="color: #c678dd;">apply</span>(reduce_category)
</pre>
</div>
</div>
</li>


<li><a id="org51a8837"></a>condition<br />
<div class="outline-text-5" id="text-2-4-8-3">
<div class="org-src-container">
<pre class="src src-python">
<span style="color: #c678dd;">print</span>(data.condition.value_counts()/<span style="color: #c678dd;">len</span>(data.condition)*<span style="color: #da8548; font-weight: bold;">100</span>)


</pre>
</div>

<pre class="example" id="orgf510a65">
other                                 25.444184
well_kept                             24.772228
refurbished                           10.040600
fully_renovated                        9.811897
first_time_use                         8.172980
mint_condition                         8.164041
modernized                             6.408910
first_time_use_after_refurbishment     5.839759
negotiable                             0.833985
need_of_renovation                     0.509927
ripe_for_demolition                    0.001490
Name: condition, dtype: float64
</pre>


<div class="org-src-container">
<pre class="src src-python">
<span style="color: #dcaeea;">change_to_other</span> = data.condition.value_counts().tail(<span style="color: #da8548; font-weight: bold;">3</span>).index
data.<span style="color: #dcaeea;">condition</span> = data.condition.<span style="color: #c678dd;">apply</span>(reduce_category)


</pre>
</div>
</div>
</li>


<li><a id="orgd45ff25"></a>typeOfFlat<br />
<div class="outline-text-5" id="text-2-4-8-4">
<div class="org-src-container">
<pre class="src src-python">
<span style="color: #c678dd;">print</span>(data.typeOfFlat.value_counts()/<span style="color: #c678dd;">len</span>(data.typeOfFlat)*<span style="color: #da8548; font-weight: bold;">100</span>)

</pre>
</div>

<pre class="example" id="orgc8e0f42">
apartment              48.920177
other                  17.160577
roof_storey            12.935524
ground_floor           11.726450
maisonette              3.468916
raised_ground_floor     2.095206
penthouse               1.328268
terraced_flat           1.260476
half_basement           0.748687
loft                    0.355719
Name: typeOfFlat, dtype: float64
</pre>



<div class="org-src-container">
<pre class="src src-python">
<span style="color: #dcaeea;">change_to_other</span> = data.typeOfFlat.value_counts().tail(<span style="color: #da8548; font-weight: bold;">2</span>).index
data.<span style="color: #dcaeea;">typeOfFlat</span> = data.condition.<span style="color: #c678dd;">apply</span>(reduce_category)



</pre>
</div>

<pre class="example" id="org79d3c0e">
apartment              48.920216
other                  17.159383
roof_storey            12.939185
ground_floor           11.730705
maisonette              3.466245
raised_ground_floor     2.093361
penthouse               1.327134
terraced_flat           1.259066
half_basement           0.748745
loft                    0.355961
Name: typeOfFlat, dtype: float64
</pre>
</div>
</li>


<li><a id="orga1be2ba"></a>regio2<br />
<div class="outline-text-5" id="text-2-4-8-5">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #c678dd;">print</span>(data.regio2.value_counts()/<span style="color: #c678dd;">len</span>(data.regio2)*<span style="color: #da8548; font-weight: bold;">100</span>)

</pre>
</div>

<pre class="example" id="org26b4a95">
Leipzig                         5.110441
Chemnitz                        4.680597
Berlin                          3.874921
Dresden                         2.800685
Magdeburg                       1.809886
                                  ...   
Lichtenfels_Kreis               0.011547
Freyung_Grafenau_Kreis          0.011174
Haßberge_Kreis                  0.008940
Neustadt_a.d._Waldnaab_Kreis    0.005960
Kronach_Kreis                   0.004470
Name: regio2, Length: 419, dtype: float64
</pre>


<div class="org-src-container">
<pre class="src src-python">
<span style="color: #dcaeea;">change_to_other</span> = data.regio2.value_counts().tail(<span style="color: #da8548; font-weight: bold;">399</span>).index
data.<span style="color: #dcaeea;">regio2</span> = data.regio2.<span style="color: #c678dd;">apply</span>(reduce_category)

</pre>
</div>

<pre class="example" id="orga5f3dc5">
other                                     45.760089
Leipzig                                    5.104333
Chemnitz                                   4.677329
Berlin                                     3.870560
Dresden                                    2.797843
Magdeburg                                  1.807699
Halle_Saale                                1.697973
München                                    1.630277
Essen                                      1.618375
Frankfurt_am_Main                          1.597917
Hamburg                                    1.398177
Düsseldorf                                 1.380324
Duisburg                                   1.310024
Mittelsachsen_Kreis                        1.176121
Dortmund                                   1.166822
Gelsenkirchen                              1.094662
Recklinghausen_Kreis                       1.024363
Köln                                       1.007625
Zwickau                                    0.943277
Wuppertal                                  0.883764
Zwickau_Kreis                              0.863307
Leipzig_Kreis                              0.861819
Meißen_Kreis                               0.822020
Sächsische_Schweiz_Osterzgebirge_Kreis     0.772922
Bochum                                     0.746513
Bremen                                     0.735354
Gera                                       0.734238
Plauen                                     0.733123
Aachen                                     0.702622
Erzgebirgskreis                            0.683653
Nürnberg                                   0.666543
Stuttgart                                  0.665055
Hannover                                   0.643853
Wiesbaden                                  0.631951
Saalekreis                                 0.621536
Märkischer_Kreis                           0.576902
Bautzen_Kreis                              0.572810
Mettmann_Kreis                             0.555700
Burgenlandkreis                            0.554212
Hagen                                      0.534499
Ennepe_Ruhr_Kreis                          0.519993
Mannheim                                   0.513297
Mönchengladbach                            0.509206
Krefeld                                    0.499163
Bonn                                       0.491352
Harz_Kreis                                 0.483541
Dessau_Roßlau                              0.473498
Erfurt                                     0.445974
Rhein_Sieg_Kreis                           0.437791
Name: regio2, dtype: float64
</pre>
</div>
</li>
</ol>
</div>
</div>



<div id="outline-container-orgd7b9ff5" class="outline-3">
<h3 id="orgd7b9ff5"><span class="section-number-3">2.5.</span> Clean duplicates</h3>
<div class="outline-text-3" id="text-2-5">
</div>
<div id="outline-container-org72348c1" class="outline-4">
<h4 id="org72348c1"><span class="section-number-4">2.5.1.</span> remove duplicates</h4>
<div class="outline-text-4" id="text-2-5-1">
<ul class="org-ul">
<li>remove duplicates from dataset</li>
</ul>


<div class="org-src-container">
<pre class="src src-python">
data.drop_duplicates(inplace=<span style="color: #a9a1e1;">True</span>)

</pre>
</div>
</div>
</div>
</div>


<div id="outline-container-orge95ad26" class="outline-3">
<h3 id="orge95ad26"><span class="section-number-3">2.6.</span> Handle Outliers</h3>
<div class="outline-text-3" id="text-2-6">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #51afef;">for</span> col <span style="color: #51afef;">in</span> data.columns:
    <span style="color: #51afef;">if</span> data[col].dtype == <span style="color: #98be65;">'int64'</span> <span style="color: #51afef;">or</span> data[col].dtype == <span style="color: #98be65;">'float64'</span>:
        upper_range = data[col].mean() + <span style="color: #da8548; font-weight: bold;">3</span> * data[col].std()
        lower_range = data[col].mean() - <span style="color: #da8548; font-weight: bold;">3</span> * data[col].std()

        indexs = data[(data[col] &gt; upper_range) | (data[col] &lt; lower_range)].index
        data = data.drop(indexs)
</pre>
</div>
</div>
</div>


<div id="outline-container-orgcd93ee1" class="outline-3">
<h3 id="orgcd93ee1"><span class="section-number-3">2.7.</span> Visual data</h3>
<div class="outline-text-3" id="text-2-7">
</div>
<div id="outline-container-org28e1f97" class="outline-4">
<h4 id="org28e1f97"><span class="section-number-4">2.7.1.</span> regio2 top 13</h4>
<div class="outline-text-4" id="text-2-7-1">
<div class="org-src-container">
<pre class="src src-python">
<span style="color: #c678dd;">print</span>(data.regio2.value_counts()/<span style="color: #c678dd;">len</span>(data)*<span style="color: #da8548; font-weight: bold;">100</span>)
<span style="color: #dcaeea;">regio2_data</span> = data.regio2.value_counts()

</pre>
</div>

<pre class="example" id="orgc2f0d42">
other                   63.127229
Leipzig                  5.104062
Chemnitz                 4.599483
Berlin                   3.871552
Dresden                  2.793639
Magdeburg                1.813224
Halle_Saale              1.671833
München                  1.656295
Essen                    1.615121
Frankfurt_am_Main        1.549475
Hamburg                  1.395654
Düsseldorf               1.393324
Duisburg                 1.301264
Dortmund                 1.178906
Mittelsachsen_Kreis      1.150939
Gelsenkirchen            1.070921
Köln                     1.013044
Recklinghausen_Kreis     1.011878
Zwickau                  0.943513
Wuppertal                0.895347
Leipzig_Kreis            0.843297
Name: regio2, dtype: float64
</pre>

<div class="org-src-container">
<pre class="src src-python">
plt.clf()
plt.figure(figsize=(<span style="color: #da8548; font-weight: bold;">15</span>,<span style="color: #da8548; font-weight: bold;">15</span>))
sns.barplot(x=regio2_data.index[<span style="color: #da8548; font-weight: bold;">1</span>:<span style="color: #da8548; font-weight: bold;">14</span>], y=regio2_data.values[<span style="color: #da8548; font-weight: bold;">1</span>:<span style="color: #da8548; font-weight: bold;">14</span>])
regio2_plot_fname = <span style="color: #98be65;">'img/regio2_plot.png'</span>
plt.savefig(regio2_plot_fname)
regio2_plot_fname

</pre>
</div>


<div id="org2566225" class="figure">
<p><img src="img/regio2_plot.png" alt="regio2_plot.png" />
</p>
</div>
</div>
</div>

<div id="outline-container-org95c5681" class="outline-4">
<h4 id="org95c5681"><span class="section-number-4">2.7.2.</span> livingSpace</h4>
<div class="outline-text-4" id="text-2-7-2">
<div class="org-src-container">
<pre class="src src-python">
<span style="color: #c678dd;">print</span>(data.livingSpace.value_counts())

</pre>
</div>

<pre class="example" id="org7987536">
60.00     4979
70.00     4008
80.00     3892
65.00     3653
75.00     3572
          ... 
140.05       1
128.60       1
166.70       1
128.43       1
158.35       1
Name: livingSpace, Length: 12907, dtype: int64
</pre>

<div class="org-src-container">
<pre class="src src-python">plt.clf()
<span style="color: #dcaeea;">livingSpace_chart_data</span> = data.livingSpace.value_counts()
plt.scatter(x=livingSpace_chart_data.index, y=livingSpace_chart_data.values)
plt.xlabel(<span style="color: #98be65;">'livingSpace'</span>)
plt.ylabel(<span style="color: #98be65;">'number'</span>)
livingSpace_plot_fname = <span style="color: #98be65;">'img/livingSpace_plot.png'</span>
plt.savefig(livingSpace_plot_fname)
livingSpace_plot_fname
</pre>
</div>


<div id="orgd07c0f9" class="figure">
<p><img src="img/livingSpace_plot.png" alt="livingSpace_plot.png" />
</p>
</div>
</div>
</div>


<div id="outline-container-org759af9d" class="outline-4">
<h4 id="org759af9d"><span class="section-number-4">2.7.3.</span> baseRent</h4>
<div class="outline-text-4" id="text-2-7-3">
<div class="org-src-container">
<pre class="src src-python">
<span style="color: #c678dd;">print</span>(data.baseRent.value_counts()/<span style="color: #c678dd;">len</span>(data)*<span style="color: #da8548; font-weight: bold;">100</span>)

</pre>
</div>

<pre class="example" id="orgb77a4e6">
350.00     1.404200
450.00     1.334670
300.00     1.168807
400.00     1.126079
650.00     1.089566
             ...   
400.44     0.000388
2749.00    0.000388
857.85     0.000388
412.40     0.000388
1255.38    0.000388
Name: baseRent, Length: 26256, dtype: float64
</pre>
</div>

<ol class="org-ol">
<li><a id="org2cfd92d"></a>yearConstructed<br />
<div class="outline-text-5" id="text-2-7-3-1">
<div class="org-src-container">
<pre class="src src-python">
plt.clf()
plt.scatter(x = data.baseRent, y = data.yearConstructed)
plt.xlabel = <span style="color: #98be65;">'baseRent'</span>
plt.ylabel = <span style="color: #98be65;">'YearConstructed'</span>
baseRent_and_yearConstructed_plot_fname = <span style="color: #98be65;">'img/baseRent_and_yearConstructed_plot.png'</span>
plt.savefig(baseRent_and_yearConstructed_plot_fname)
baseRent_and_yearConstructed_plot_fname


</pre>
</div>


<div id="orgbc89182" class="figure">
<p><img src="img/baseRent_and_yearConstructed_plot.png" alt="baseRent_and_yearConstructed_plot.png" />
</p>
</div>
</div>
</li>

<li><a id="org4ebe1e3"></a>regio2<br />
<div class="outline-text-5" id="text-2-7-3-2">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #dcaeea;">lower_mask_baseR</span> = (data.baseRent &gt; <span style="color: #da8548; font-weight: bold;">10</span>)
<span style="color: #dcaeea;">upper_mask_baseR</span> = (data.baseRent &lt; <span style="color: #da8548; font-weight: bold;">2000</span>)
<span style="color: #dcaeea;">baseR_mask</span> = lower_mask_baseR &amp; upper_mask_baseR

<span style="color: #dcaeea;">baseR_data</span> = data[baseR_mask]

</pre>
</div>

<div class="org-src-container">
<pre class="src src-python">
plt.clf()
plt.figure(figsize=(<span style="color: #da8548; font-weight: bold;">10</span>,<span style="color: #da8548; font-weight: bold;">10</span>))
plt.scatter(x = baseR_data.baseRent, y = baseR_data.regio2)
plt.xlabel = <span style="color: #98be65;">'baseRent'</span>
plt.ylabel = <span style="color: #98be65;">'regio2'</span>
baseRent_and_regio2_plot_fname = <span style="color: #98be65;">'img/baseRent_and_regio2_plot.png'</span>
plt.savefig(baseRent_and_regio2_plot_fname)
baseRent_and_regio2_plot_fname

</pre>
</div>


<div id="orgc330f1a" class="figure">
<p><img src="img/baseRent_and_regio2_plot.png" alt="baseRent_and_regio2_plot.png" />
</p>
</div>
</div>
</li>
</ol>
</div>




<div id="outline-container-org0297c4d" class="outline-4">
<h4 id="org0297c4d"><span class="section-number-4">2.7.4.</span> houses</h4>
<div class="outline-text-4" id="text-2-7-4">
</div>
<ol class="org-ol">
<li><a id="org604b638"></a>typeOfFlat &amp; yearConstructed<br />
<div class="outline-text-5" id="text-2-7-4-1">
<div class="org-src-container">
<pre class="src src-python">plt.clf()
sns.catplot(x=<span style="color: #98be65;">"typeOfFlat"</span>, y=<span style="color: #98be65;">"yearConstructed"</span>, hue=<span style="color: #98be65;">"baseRentRange"</span>,kind=<span style="color: #98be65;">'swarm'</span>, data=data.sample(<span style="color: #da8548; font-weight: bold;">4000</span>),aspect=<span style="color: #da8548; font-weight: bold;">17.5</span>/<span style="color: #da8548; font-weight: bold;">17.5</span>,height=<span style="color: #da8548; font-weight: bold;">18</span>)
houses_with_typeOfFlat_n_yearConstructed_baseRentRange_plot_fname = <span style="color: #98be65;">'img/houses_with_typeOfFlat_n_yearConstructed_baseRentRange.png'</span>
plt.savefig(houses_with_typeOfFlat_n_yearConstructed_baseRentRange_plot_fname)
houses_with_typeOfFlat_n_yearConstructed_baseRentRange_plot_fname

</pre>
</div>


<div id="orgde61208" class="figure">
<p><img src="img/houses_with_typeOfFlat_n_yearConstructed_baseRentRange.png" alt="houses_with_typeOfFlat_n_yearConstructed_baseRentRange.png" />
</p>
</div>

<div class="org-src-container">
<pre class="src src-python">
sns.catplot(x=<span style="color: #98be65;">"color"</span>, y=<span style="color: #98be65;">"price"</span>, kind=<span style="color: #98be65;">"boxen"</span>,
            data=data)

</pre>
</div>

<p>
<a href=""></a>
</p>
</div>
</li>


<li><a id="org5422e48"></a>heatingType &amp;  livingSpace<br />
<div class="outline-text-5" id="text-2-7-4-2">
<div class="org-src-container">
<pre class="src src-python">plt.clf()
sns.catplot(x=<span style="color: #98be65;">"heatingType"</span>, y=<span style="color: #98be65;">"livingSpace"</span>, hue=<span style="color: #98be65;">"baseRentRange"</span>,kind=<span style="color: #98be65;">'swarm'</span>, data=data.sample(<span style="color: #da8548; font-weight: bold;">4000</span>),aspect=<span style="color: #da8548; font-weight: bold;">17.5</span>/<span style="color: #da8548; font-weight: bold;">17.5</span>,height=<span style="color: #da8548; font-weight: bold;">18</span>)
houses_with_heatingType_n_livingSpace_baseRentRange_plot_fname = <span style="color: #98be65;">'img/houses_with_heatingType_n_livingSpace_baseRentRange.png'</span>
plt.savefig(houses_with_heatingType_n_livingSpace_baseRentRange_plot_fname)
houses_with_heatingType_n_livingSpace_baseRentRange_plot_fname

</pre>
</div>


<div id="orgb46ee0d" class="figure">
<p><img src="img/houses_with_heatingType_n_livingSpace_baseRentRange.png" alt="houses_with_heatingType_n_livingSpace_baseRentRange.png" />
</p>
</div>
</div>
</li>
</ol>
</div>
</div>



<div id="outline-container-org799934a" class="outline-3">
<h3 id="org799934a"><span class="section-number-3">2.8.</span> Models</h3>
<div class="outline-text-3" id="text-2-8">
</div>
<div id="outline-container-org1730360" class="outline-4">
<h4 id="org1730360"><span class="section-number-4">2.8.1.</span> prepare data for model</h4>
<div class="outline-text-4" id="text-2-8-1">
</div>
<ol class="org-ol">
<li><a id="orgfcd0f79"></a>select feature<br />
<div class="outline-text-5" id="text-2-8-1-1">
<div class="org-src-container">
<pre class="src src-python">
<span style="color: #c678dd;">print</span>(data.columns)

</pre>
</div>

<pre class="example">
Index(['serviceCharge', 'heatingType', 'newlyConst', 'balcony', 'totalRent',
       'yearConstructed', 'hasKitchen', 'cellar', 'baseRent', 'livingSpace',
       'condition', 'interiorQual', 'petsAllowed', 'lift', 'baseRentRange',
       'typeOfFlat', 'noRooms', 'thermalChar', 'floor', 'numberOfFloors',
       'garden', 'regio2'],
      dtype='object')
</pre>



<div class="org-src-container">
<pre class="src src-python">
<span style="color: #dcaeea;">model_data_1</span> = data[[ <span style="color: #98be65;">'yearConstructed'</span> ,<span style="color: #98be65;">'serviceCharge'</span>,<span style="color: #98be65;">'heatingType'</span>, <span style="color: #98be65;">'balcony'</span>, <span style="color: #98be65;">'hasKitchen'</span>, <span style="color: #98be65;">'livingSpace'</span>, <span style="color: #98be65;">'baseRent'</span>]]
<span style="color: #dcaeea;">model_data_2</span> = data[[ <span style="color: #98be65;">'yearConstructed'</span> ,<span style="color: #98be65;">'noRooms'</span>,<span style="color: #98be65;">'heatingType'</span>, <span style="color: #98be65;">'cellar'</span>, <span style="color: #98be65;">'hasKitchen'</span>, <span style="color: #98be65;">'numberOfFloors'</span>, <span style="color: #98be65;">'baseRent'</span>]]
<span style="color: #dcaeea;">model_data_3</span> = data[[ <span style="color: #98be65;">'yearConstructed'</span> ,<span style="color: #98be65;">'noRooms'</span>,<span style="color: #98be65;">'interiorQual'</span>, <span style="color: #98be65;">'condition'</span>, <span style="color: #98be65;">'hasKitchen'</span>, <span style="color: #98be65;">'livingSpace'</span>, <span style="color: #98be65;">'baseRent'</span>]]
<span style="color: #dcaeea;">model_data_4</span> = data[[ <span style="color: #98be65;">'garden'</span> ,<span style="color: #98be65;">'floor'</span>,<span style="color: #98be65;">'typeOfFlat'</span>, <span style="color: #98be65;">'cellar'</span>, <span style="color: #98be65;">'hasKitchen'</span>, <span style="color: #98be65;">'numberOfFloors'</span>, <span style="color: #98be65;">'baseRent'</span>]]

</pre>
</div>
</div>
</li>

<li><a id="orgc4ee8b4"></a>encode data<br />
<div class="outline-text-5" id="text-2-8-1-2">
<div class="org-src-container">
<pre class="src src-python">
<span style="color: #dcaeea;">column_to_encode</span> = get_categorical_data(data)

<span style="color: #51afef;">def</span> <span style="color: #c678dd;">encode</span>(data):
    <span style="color: #51afef;">for</span> column <span style="color: #51afef;">in</span> data.<span style="color: #dcaeea;">columns</span>[data.columns.isin(column_to_encode)]:
        data[<span style="color: #dcaeea;">column</span>] = data[column].factorize()[<span style="color: #da8548; font-weight: bold;">0</span>]
    <span style="color: #51afef;">return</span> data

<span style="color: #dcaeea;">model_data_1_encoded</span> = encode(model_data_1.copy())
<span style="color: #dcaeea;">model_data_2_encoded</span> = encode(model_data_2.copy())
<span style="color: #dcaeea;">model_data_3_encoded</span> = encode(model_data_3.copy())
<span style="color: #dcaeea;">model_data_4_encoded</span> = encode(model_data_4.copy())
</pre>
</div>
</div>
</li>
</ol>
</div>


<div id="outline-container-org776d1ec" class="outline-4">
<h4 id="org776d1ec"><span class="section-number-4">2.8.2.</span> split data and model</h4>
<div class="outline-text-4" id="text-2-8-2">
<div class="org-src-container">
<pre class="src src-python">

<span style="color: #51afef;">def</span> <span style="color: #c678dd;">model_trainer</span>(data):

    <span style="color: #dcaeea;">x</span> = data.iloc[:,[<span style="color: #da8548; font-weight: bold;">0</span>,<span style="color: #da8548; font-weight: bold;">1</span>,<span style="color: #da8548; font-weight: bold;">2</span>,<span style="color: #da8548; font-weight: bold;">3</span>,<span style="color: #da8548; font-weight: bold;">4</span>,<span style="color: #da8548; font-weight: bold;">5</span>]]
    <span style="color: #dcaeea;">y</span> = data.iloc[:,[<span style="color: #da8548; font-weight: bold;">6</span>]]
    <span style="color: #dcaeea;">x_train</span>,<span style="color: #dcaeea;">x_test</span>,<span style="color: #dcaeea;">y_train</span>,<span style="color: #dcaeea;">y_test</span>=train_test_split(x,y,test_size=.<span style="color: #da8548; font-weight: bold;">2</span>,random_state=<span style="color: #da8548; font-weight: bold;">500</span> )
    linear_model = LinearRegression()
    linear_model.fit(x_train,y_train)
    y_pred = linear_model.predict(x_test)
    <span style="color: #c678dd;">print</span>(r2_score(y_test,y_pred))
    <span style="color: #51afef;">return</span> (y_test, y_pred)


data1 = model_trainer(model_data_1_encoded)
data2 = model_trainer(model_data_2_encoded)
data3 = model_trainer(model_data_3_encoded)
data4 = model_trainer(model_data_4_encoded)
</pre>
</div>

<pre class="example">
0.5404128121895404
0.2856885743825939
0.5387703899065475
0.0787720846257648
</pre>
</div>
</div>
</div>






<div id="outline-container-org641a544" class="outline-3">
<h3 id="org641a544"><span class="section-number-3">2.9.</span> ‫‪Multiprocessing‬‬</h3>
<div class="outline-text-3" id="text-2-9">
<ul class="org-ul">
<li>use multiprocessing to get outliers indexes</li>
</ul>

<div class="org-src-container">
<pre class="src src-python">
<span style="color: #51afef;">def</span> <span style="color: #c678dd;">detect_outlier_and_drop</span>(data):
    <span style="color: #dcaeea;">indexs</span> = []
    <span style="color: #51afef;">if</span> data.dtype == <span style="color: #98be65;">'int64'</span> <span style="color: #51afef;">or</span> data.dtype == <span style="color: #98be65;">'float64'</span>:
        upper_range = data.mean() + <span style="color: #da8548; font-weight: bold;">3</span> * data.std()
        lower_range = data.mean() - <span style="color: #da8548; font-weight: bold;">3</span> * data.std()

        indexs = data[(data &gt; upper_range) | (data &lt; lower_range)].index
    <span style="color: #51afef;">return</span> indexs

</pre>
</div>

<div class="org-src-container">
<pre class="src src-python">
<span style="color: #dcaeea;">s_time</span> = time.time()

<span style="color: #dcaeea;">clean_list</span> = <span style="color: #c678dd;">list</span>(<span style="color: #c678dd;">map</span>(detect_outlier_and_drop, [(raw_data[col]) <span style="color: #51afef;">for</span> col <span style="color: #51afef;">in</span> raw_data._get_numeric_data().columns]))
<span style="color: #c678dd;">print</span>(f<span style="color: #98be65;">'run time : </span>{time.time() - s_time}<span style="color: #98be65;">'</span>)
</pre>
</div>

<pre class="example">
run time : 0.07328987121582031
</pre>


<div class="org-src-container">
<pre class="src src-python"><span style="color: #dcaeea;">s_time</span> = time.time()
<span style="color: #51afef;">with</span> mp.Pool(mp.cpu_count()) <span style="color: #51afef;">as</span> <span style="color: #dcaeea;">p</span>:
    clean_data_from_p = <span style="color: #c678dd;">list</span>(p.imap(detect_outlier_and_drop,[raw_data[col] <span style="color: #51afef;">for</span> col <span style="color: #51afef;">in</span> raw_data._get_numeric_data().columns] ))
<span style="color: #c678dd;">print</span>(f<span style="color: #98be65;">'run time : </span>{time.time() - s_time}<span style="color: #98be65;">'</span>)

</pre>
</div>

<pre class="example">
run time : 0.27236175537109375
</pre>
</div>
</div>


<div id="outline-container-org22a5db7" class="outline-3">
<h3 id="org22a5db7"><span class="section-number-3">2.10.</span> <span class="todo TODO">TODO</span> dask &amp; pyspark</h3>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Author: Mohammadb Ghorbani</p>
<p class="date">Created: 2022-05-19 Thu 19:46</p>
</div>
</body>
</html>
